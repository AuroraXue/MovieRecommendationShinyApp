---
title: "R Notebook"
output: html_notebook
---

##Step 1: Load data and libraries
```{r}
library(plyr)
load("/Users/ouminamikun/Documents/Columbia/Spring 2017/ADS/final project/dat.RData")
```

##Step 2: 
```{r}
movie_agg <- aggregate(dat$rating, list(dat$movie_name), mean)
colnames(movie_agg) <- c("movies", "avg_rating")

users_count <- aggregate(dat$movie_name,list(dat$movie_name), length)
movie_agg$users_count <- users_count$x
movie_agg <- movie_agg[order(movie_agg$avg_rating, decreasing = T), ]

nopop <- movie_agg[movie_agg$users_count <= 6,]
nopop_hrated <- head(nopop$movies, 10)
pop <- movie_agg[movie_agg$users_count >=76,]
pop_lrated <- rev(tail(pop$movies, 10))

top50 <- head(movie_agg$movies[movie_agg$users_count >= 250],50)
worst50 <- rev(tail(movie_agg$movies, 50))
```

##Step 3: not popular but highly rated
```{r}
dat_split <- split(dat, dat$movie_name)
dat_split_sum <- lapply(dat_split, summary)
num_users <- sapply(dat_split, nrow)

n <- length(dat_split)
rating_agv <- NA
movie_name <- NA
for(i in 1:n){
  rating_agv[i] <- mean(dat_split[[i]]$rating)
  movie_name[i] <- unique(dat_split[[i]]$movie_name)
}
```

```{r}
library(omdbapi)
library(dplyr)
library(rvest)
library(RCurl)
library(jpeg)

lego_movie <- read_html("http://www.imdb.com/title/tt1490017/")
poster <- lego_movie %>%
  html_nodes(".poster img") %>%
  html_attr("src")
poster

A <- find_by_title("Game of Thrones", type="series", season=1, episode=1)

A$imdbRating
A$Plot
A$Poster

B <- find_by_title("Annie Hall")
b <- B$Poster
b[1]


pic <- readJPEG(getURLContent(b[2]))
plot(0:1,0:1,type="n",ann=FALSE,axes=FALSE)
ah <- rasterImage(pic,0,0,1,1)


```

## Shiny app
```{r}
library(shiny)
library(shinydashboard)

ui <- dashboardPage(
  dashboardHeader(),
  
  dashboardSidebar(
    sidebarMenu(
      menuItem("Dashboard", tabName = "dashboard", icon = icon("dashboard"))
    )
  ),
  
  dashboardBody(
      tabItem(tabName = "dashboard",
              fluidRow(
                box(
                  title = "Top 50",
                  status = "primary",
                  solidHeader = TRUE,
                  collapsible = TRUE,
                  verbatimTextOutput("top50")),
                box(
                  title = "Popular but bad movies",
                  status = "success",
                  solidHeader = T,
                  verbatimTextOutput("pop_lrated")),
                box(
                  title = "Not popular but great movies",
                  status = "danger",
                  solidHeader = T,
                  verbatimTextOutput("nopop_hrated")),
                box(
                  title = "poster",
                  status = "danger",
                  plotOutput("poster"))
                )
              )
      
    )
  )


server <- function(input, output) { 
  
  output$top50 <- renderText({ top50_s })
  output$pop_lrated <- renderText({pop_lrated_s})
  output$nopop_hrated <- renderText({nopop_hrated_s})
  output$poster <- renderPlot({showposter("Annie Hall")})
  }

shinyApp(ui = ui, server = server)
```

```{r}

top50_s <- top50[1]
for(i in 2:length(top50)){
  top50_s <- paste(top50_s,top50[i], sep = "\n")
}


pop_lrated_s <- pop_lrated[1]
for(i in 2:length(pop_lrated)){
  pop_lrated_s <- paste(pop_lrated_s, pop_lrated[i], sep = "\n")
}

nopop_hrated_s <- nopop_hrated[1]
for(i in 2:length(nopop_hrated)){
  nopop_hrated_s <- paste(nopop_hrated_s, nopop_hrated[i],sep = "\n")
}
```